# 4.1 标签编辑和数据处理



## 标签编辑



对数据内容标签进行编辑定义，数据的获取方式有

A).从源码中获取数据

B).生成固定格式的数据

C).已有标签组合



---




### A).从源码中获取数据：



可精确地设置标签的来源是从默认页的源码、返回头信息和网页地址中，或者是分页、循环分块、多页中。

其数据提取方式包括： 

1. A.a).前后截取
2. A.b).正则提取
3. A.c).正文提取
4. A.d).Xpath提取
5. A.e).JSON 提取


### B).生成固定格式的数据：



可生成固定的字符串、系统时间、随机字符串、随机数字、系统时间戳、随机抽取信息


### C).已有标签组合：



可通过组合已有的标签，来生成新的标签内容

**A.a).前后截取**

通过设置开始字符串和结束字符串，来获取中间的字符，可以在开始和结束字符串中设置通配符（*）

**A.b).正则提取**

支持两种正则，一个纯正则，一个参数正则。
先介绍纯正则，举个例子，
如：```前字符串 (?<content>[\s\S]*?)后字符串```，这个正则其实效果跟前后截取一样，
如需要获取全部代码，则为```^(?<content>[\s\S]*?)$``` ，此功能运用需有一定的正则基础。

关于参数正则，是通过参数组合，来生成内容。
比如说要匹配标题为“新用户注册”和作者“神秘嘉宾”，代码如下：
```
<div class="content">
                <h2>新用户注册</h2>
<div id="tools">【作者：神秘嘉宾】【字号：<a href="#" class="fontSize">大</a>
```

设置如图：

![](http://imgs.leesven.com/2016/locoyimgs/41.png)

需要获取的字段用参数表示，不需要的字段或空格用星号代替；在组合结果里可以对多个参数进行组合。

**A.c).正文提取**

注意这种方式只适合格式较为规则的多文字数据提取，例如新闻文章。

它不需要设置复杂的规则，可智能分析提取文章正文，文章标题，以及发布时间。

![](http://imgs.leesven.com/2016/locoyimgs/42.png)

**A.d).Xpath提取**

通过Xpath表达式来获取数据，比如//div[@id=’content’]，

就是获取id为content的div可指定要获取html节点的属性，

比如 ```Innerhtml、Outerhtml、Innertext、Href```属性。

（注意：这种有一定的局限性，对于部分html标签不规范的页面无法解析。）

**A.e).JSON提取**

通过对JSON形式的数据格式化操作，写表达式来获取其节点数据。



## 数据处理



对从内容页面提取的数据进行进一步处理，可以同时添加多个操作，按照从上到下的顺序来执行。

也就是说，上个步骤的结果会作为下个步骤的参数。

1. 提取内容为空：如果提取内容为空，则使用正则匹配从原始页面中再次提取
2. 内容替换/排除：将采集到的内容进行字符串替换，如需排除，则替换为空字符串即可
3. html标签过滤：过滤指定html标签，比如```<a ，<font``` 
4. 字符截取：通过开始和结束字符串对内容进行截取
5. 纯正则替换：通过强大的正则表达式进行复杂的替换。
6. 数据转换：包括将结果简转繁、将结果繁转简、自动转化为拼音和时间修正转化
7. 智能提取：包括提取第一张图片、智能提取时间、智能提取邮箱、智能提取手机号码、智能提取电话号码
8. 高级功能：包括自动摘要、自动分词、Http请求、字符编码转换、同义词替换、空内容缺省值、内容加前后缀、随机插入、运行C#代码、批量内容替换，统计标签字符串长度等一系列功能。
9. 补全单网址：将当前内容作为一个网址进行补全。
10. 文件下载：可以自动探测并下载文件，可设置下载路径和文件名样式。
11. 内容过滤：对于一些不符合条件的记录，可以通过设置内容过滤来删除或标记为未采。

![](http://imgs.leesven.com/2016/locoyimgs/43.png)